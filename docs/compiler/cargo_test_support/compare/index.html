<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Routines for comparing and diffing output."><title>cargo_test_support::compare - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="cargo_test_support" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0-nightly (0aeaa5eb2 2024-12-14)" data-channel="nightly" data-search-js="search-92e6798f.js" data-settings-js="settings-0f613d39.js" ><script src="../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../cargo_test_support/index.html">cargo_<wbr>test_<wbr>support</a><span class="version">1.85.0-nightly</span></h2></div><div class="version">(0aeaa5eb2	2024-12-14)</div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module compare</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#deprecated-comparisons" title="Deprecated comparisons">Deprecated comparisons</a><ul><li><a href="#patterns" title="Patterns">Patterns</a></li><li><a href="#normalization" title="Normalization">Normalization</a></li></ul></li></ul><h3><a href="#macros">Module Items</a></h3><ul class="block"><li><a href="#macros" title="Macros">Macros</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#statics" title="Statics">Statics</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate cargo_<wbr>test_<wbr>support</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../index.html">cargo_test_support</a></span><h1>Module <span>compare</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/cargo_test_support/compare.rs.html#1-688">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Routines for comparing and diffing output.</p>
<h2 id="deprecated-comparisons"><a class="doc-anchor" href="#deprecated-comparisons">§</a>Deprecated comparisons</h2>
<p>Cargo’s tests are in transition from internal-only pattern and normalization routines used in
asserts like <a href="../struct.Execs.html#method.with_stdout_contains" title="method cargo_test_support::Execs::with_stdout_contains"><code>crate::Execs::with_stdout_contains</code></a> to <a href="fn.assert_e2e.html" title="fn cargo_test_support::compare::assert_e2e"><code>assert_e2e</code></a> and <a href="fn.assert_ui.html" title="fn cargo_test_support::compare::assert_ui"><code>assert_ui</code></a>.</p>
<h3 id="patterns"><a class="doc-anchor" href="#patterns">§</a>Patterns</h3>
<p>Many of these functions support special markup to assist with comparing
text that may vary or is otherwise uninteresting for the test at hand. The
supported patterns are:</p>
<ul>
<li><code>[..]</code> is a wildcard that matches 0 or more characters on the same line
(similar to <code>.*</code> in a regex). It is non-greedy.</li>
<li><code>[EXE]</code> optionally adds <code>.exe</code> on Windows (empty string on other
platforms).</li>
<li><code>[ROOT]</code> is the path to the test directory’s root.</li>
<li><code>[CWD]</code> is the working directory of the process that was run.</li>
<li>There is a wide range of substitutions (such as <code>[COMPILING]</code> or
<code>[WARNING]</code>) to match cargo’s “status” output and allows you to ignore
the alignment. See the source of <code>substitute_macros</code> for a complete list
of substitutions.</li>
<li><code>[DIRTY-MSVC]</code> (only when the line starts with it) would be replaced by
<code>[DIRTY]</code> when <code>cfg(target_env = "msvc")</code> or the line will be ignored otherwise.
Tests that work around <a href="https://github.com/rust-lang/cargo/issues/7358">issue 7358</a>
can use this to avoid duplicating the <code>with_stderr</code> call like:
<code>if cfg!(target_env = "msvc") {e.with_stderr("...[DIRTY]...");} else {e.with_stderr("...");}</code>.</li>
</ul>
<h3 id="normalization"><a class="doc-anchor" href="#normalization">§</a>Normalization</h3>
<p>In addition to the patterns described above, the strings are normalized
in such a way to avoid unwanted differences. The normalizations are:</p>
<ul>
<li>Raw tab characters are converted to the string <code>&lt;tab&gt;</code>. This is helpful
so that raw tabs do not need to be written in the expected string, and
to avoid confusion of tabs vs spaces.</li>
<li>Backslashes are converted to forward slashes to deal with Windows paths.
This helps so that all tests can be written assuming forward slashes.
Other heuristics are applied to try to ensure Windows-style paths aren’t
a problem.</li>
<li>Carriage returns are removed, which can help when running on Windows.</li>
</ul>
</div></details><h2 id="macros" class="section-header">Macros<a href="#macros" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="macro" href="macro.impl_from_tuple_for_inmemorydir.html" title="macro cargo_test_support::compare::impl_from_tuple_for_inmemorydir">impl_<wbr>from_<wbr>tuple_<wbr>for_<wbr>inmemorydir</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Create an <code>impl _ for InMemoryDir</code> for a generic tuple</div></li><li><div class="item-name"><a class="macro" href="macro.impl_from_tuples_for_inmemorydir.html" title="macro cargo_test_support::compare::impl_from_tuples_for_inmemorydir">impl_<wbr>from_<wbr>tuples_<wbr>for_<wbr>inmemorydir</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Extend <code>impl_from_tuple_for_inmemorydir</code> to generate for the specified tuple and all smaller
tuples</div></li><li><div class="item-name"><a class="macro" href="macro.regex.html" title="macro cargo_test_support::compare::regex">regex</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">This makes it easier to write regex replacements that are guaranteed to only
get compiled once</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.InMemoryDir.html" title="struct cargo_test_support::compare::InMemoryDir">InMemory<wbr>Dir</a></div></li><li><div class="item-name"><a class="struct" href="struct.WildStr.html" title="struct cargo_test_support::compare::WildStr">WildStr</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">A single line string that supports <code>[..]</code> wildcard matching.</div></li></ul><h2 id="statics" class="section-header">Statics<a href="#statics" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="static" href="static.E2E_LITERAL_REDACTIONS.html" title="static cargo_test_support::compare::E2E_LITERAL_REDACTIONS">E2E_<wbr>LITERAL_<wbr>REDACTIONS</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="static" href="static.MIN_LITERAL_REDACTIONS.html" title="static cargo_test_support::compare::MIN_LITERAL_REDACTIONS">MIN_<wbr>LITERAL_<wbr>REDACTIONS</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.add_regex_redactions.html" title="fn cargo_test_support::compare::add_regex_redactions">add_<wbr>regex_<wbr>redactions</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.add_test_support_redactions.html" title="fn cargo_test_support::compare::add_test_support_redactions">add_<wbr>test_<wbr>support_<wbr>redactions</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.assert_e2e.html" title="fn cargo_test_support::compare::assert_e2e">assert_<wbr>e2e</a></div><div class="desc docblock-short">Assertion policy for functional end-to-end tests</div></li><li><div class="item-name"><a class="fn" href="fn.assert_ui.html" title="fn cargo_test_support::compare::assert_ui">assert_<wbr>ui</a></div><div class="desc docblock-short">Assertion policy for UI tests</div></li><li><div class="item-name"><a class="fn" href="fn.match_contains.html" title="fn cargo_test_support::compare::match_contains">match_<wbr>contains</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Checks that the given string contains the given contiguous lines
somewhere.</div></li><li><div class="item-name"><a class="fn" href="fn.match_does_not_contain.html" title="fn cargo_test_support::compare::match_does_not_contain">match_<wbr>does_<wbr>not_<wbr>contain</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Checks that the given string does not contain the given contiguous lines
anywhere.</div></li><li><div class="item-name"><a class="fn" href="fn.match_with_without.html" title="fn cargo_test_support::compare::match_with_without">match_<wbr>with_<wbr>without</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Checks that the given string has a line that contains the given patterns,
and that line also does not contain the <code>without</code> patterns.</div></li><li><div class="item-name"><a class="fn" href="fn.meta_cmp.html" title="fn cargo_test_support::compare::meta_cmp">meta_<wbr>cmp</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.normalize_actual.html" title="fn cargo_test_support::compare::normalize_actual">normalize_<wbr>actual</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Normalizes the output so that it can be compared against the expected value.</div></li><li><div class="item-name"><a class="fn" href="fn.normalize_expected.html" title="fn cargo_test_support::compare::normalize_expected">normalize_<wbr>expected</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Normalizes the expected string so that it can be compared against the actual output.</div></li></ul></section></div></main></body></html>