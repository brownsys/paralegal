<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Utilities for retrying a network operation."><title>cargo::util::network::retry - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="cargo" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0-nightly (0aeaa5eb2 2024-12-14)" data-channel="nightly" data-search-js="search-92e6798f.js" data-settings-js="settings-0f613d39.js" ><script src="../../../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../cargo/index.html">cargo</a><span class="version">1.85.0-nightly</span></h2></div><div class="version">(0aeaa5eb2	2024-12-14)</div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module retry</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In cargo::<wbr>util::<wbr>network</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../../index.html">cargo</a>::<wbr><a href="../../index.html">util</a>::<wbr><a href="../index.html">network</a></span><h1>Module <span>retry</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../src/cargo/util/network/retry.rs.html#1-317">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Utilities for retrying a network operation.</p>
<p>Some network errors are considered â€œspuriousâ€, meaning it is not a real
error (such as a 404 not found) and is likely a transient error (like a
bad network connection) that we can hope will resolve itself shortly. The
<a href="struct.Retry.html" title="struct cargo::util::network::retry::Retry"><code>Retry</code></a> type offers a way to repeatedly perform some kind of network
operation with a delay if it detects one of these possibly transient
errors.</p>
<p>This supports errors from <a href="https://docs.rs/git2/0.19/git2/index.html" title="mod git2"><code>git2</code></a>, [<code>gix</code>], <a href="https://docs.rs/curl/0.4/curl/index.html" title="mod curl"><code>curl</code></a>, and
<a href="../../errors/struct.HttpNotSuccessful.html" title="struct cargo::util::errors::HttpNotSuccessful"><code>HttpNotSuccessful</code></a> 5xx HTTP errors.</p>
<p>The number of retries can be configured by the user via the <code>net.retry</code>
config option. This indicates the number of times to retry the operation
(default 3 times for a total of 4 attempts).</p>
<p>There are hard-coded constants that indicate how long to sleep between
retries. The constants are tuned to balance a few factors, such as the
responsiveness to the user (we donâ€™t want cargo to hang for too long
retrying things), and accommodating things like Cloudfrontâ€™s default
negative TTL of 10 seconds (if Cloudfront gets a 5xx error for whatever
reason it wonâ€™t try to fetch again for 10 seconds).</p>
<p>The timeout also implements a primitive form of random jitter. This is so
that if multiple requests fail at the same time that they donâ€™t all flood
the server at the same time when they are retried. This jitter still has
some clumping behavior, but should be good enough.</p>
<p><a href="struct.Retry.html" title="struct cargo::util::network::retry::Retry"><code>Retry</code></a> is the core type for implementing retry logic. The
<a href="struct.Retry.html#method.try" title="method cargo::util::network::retry::Retry::try"><code>Retry::try</code></a> method can be called with a callback, and it will
indicate if it needs to be called again sometime in the future if there
was a possibly transient error. The caller is responsible for sleeping the
appropriate amount of time and then calling <a href="struct.Retry.html#method.try" title="method cargo::util::network::retry::Retry::try"><code>Retry::try</code></a> again.</p>
<p><a href="fn.with_retry.html" title="fn cargo::util::network::retry::with_retry"><code>with_retry</code></a> is a convenience function that will create a <a href="struct.Retry.html" title="struct cargo::util::network::retry::Retry"><code>Retry</code></a> and
handle repeatedly running a callback until it succeeds, or it runs out of
retries.</p>
<p>Some interesting resources about retries:</p>
<ul>
<li><a href="https://aws.amazon.com/blogs/architecture/exponential-backoff-and-jitter/">https://aws.amazon.com/blogs/architecture/exponential-backoff-and-jitter/</a></li>
<li><a href="https://en.wikipedia.org/wiki/Exponential_backoff">https://en.wikipedia.org/wiki/Exponential_backoff</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Retry-After">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Retry-After</a></li>
</ul>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Retry.html" title="struct cargo::util::network::retry::Retry">Retry</a></div><div class="desc docblock-short">State for managing retrying a network operation.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.RetryResult.html" title="enum cargo::util::network::retry::RetryResult">Retry<wbr>Result</a></div><div class="desc docblock-short">The result of attempting some operation via <a href="struct.Retry.html#method.try" title="method cargo::util::network::retry::Retry::try"><code>Retry::try</code></a>.</div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.INITIAL_RETRY_JITTER_MS.html" title="constant cargo::util::network::retry::INITIAL_RETRY_JITTER_MS">INITIAL_<wbr>RETRY_<wbr>JITTER_<wbr>MS</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">The maximum amount of additional time the initial retry will take (milliseconds).</div></li><li><div class="item-name"><a class="constant" href="constant.INITIAL_RETRY_SLEEP_BASE_MS.html" title="constant cargo::util::network::retry::INITIAL_RETRY_SLEEP_BASE_MS">INITIAL_<wbr>RETRY_<wbr>SLEEP_<wbr>BASE_<wbr>MS</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">The minimum initial amount of time a retry will be delayed (milliseconds).</div></li><li><div class="item-name"><a class="constant" href="constant.MAX_RETRY_SLEEP_MS.html" title="constant cargo::util::network::retry::MAX_RETRY_SLEEP_MS">MAX_<wbr>RETRY_<wbr>SLEEP_<wbr>MS</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Maximum amount of time a single retry can be delayed (milliseconds).</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.maybe_spurious.html" title="fn cargo::util::network::retry::maybe_spurious">maybe_<wbr>spurious</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.with_retry.html" title="fn cargo::util::network::retry::with_retry">with_<wbr>retry</a></div><div class="desc docblock-short">Wrapper method for network call retry logic.</div></li></ul></section></div></main></body></html>