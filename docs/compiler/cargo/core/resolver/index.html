<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Resolution of the entire dependency graph for a crate."><title>cargo::core::resolver - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="cargo" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0-nightly (0aeaa5eb2 2024-12-14)" data-channel="nightly" data-search-js="search-92e6798f.js" data-settings-js="settings-0f613d39.js" ><script src="../../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../cargo/index.html">cargo</a><span class="version">1.85.0-nightly</span></h2></div><div class="version">(0aeaa5eb2	2024-12-14)</div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module resolver</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#performance" title="Performance">Performance</a></li></ul><h3><a href="#reexports">Module Items</a></h3><ul class="block"><li><a href="#reexports" title="Re-exports">Re-exports</a></li><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#functions" title="Functions">Functions</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In cargo::<wbr>core</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../index.html">cargo</a>::<wbr><a href="../index.html">core</a></span><h1>Module <span>resolver</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/cargo/core/resolver/mod.rs.html#1-1086">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Resolution of the entire dependency graph for a crate.</p>
<p>This module implements the core logic in taking the world of crates and
constraints and creating a resolved graph with locked versions for all
crates and their dependencies. This is separate from the registry module
which is more worried about discovering crates from various sources, this
module just uses the Registry trait as a source to learn about crates from.</p>
<p>Actually solving a constraint graph is an NP-hard problem. This algorithm
is basically a nice heuristic to make sure we get roughly the best answer
most of the time. The constraints that we’re working with are:</p>
<ol>
<li>Each crate can have any number of dependencies. Each dependency can
declare a version range that it is compatible with.</li>
<li>Crates can be activated with multiple version (e.g., show up in the
dependency graph twice) so long as each pairwise instance have
semver-incompatible versions.</li>
</ol>
<p>The algorithm employed here is fairly simple, we simply do a DFS, activating
the “newest crate” (highest version) first and then going to the next
option. The heuristics we employ are:</p>
<ul>
<li>Never try to activate a crate version which is incompatible. This means we
only try crates which will actually satisfy a dependency and we won’t ever
try to activate a crate that’s semver compatible with something else
activated (as we’re only allowed to have one) nor try to activate a crate
that has the same links attribute as something else
activated.</li>
<li>Always try to activate the highest version crate first. The default
dependency in Cargo (e.g., when you write <code>foo = "0.1.2"</code>) is
semver-compatible, so selecting the highest version possible will allow us
to hopefully satisfy as many dependencies at once.</li>
</ul>
<p>Beyond that, what’s implemented below is just a naive backtracking version
which should in theory try all possible combinations of dependencies and
versions to see if one works. The first resolution that works causes
everything to bail out immediately and return success, and only if <em>nothing</em>
works do we actually return an error up the stack.</p>
<p>Resolution is currently performed twice</p>
<ol>
<li>With all features enabled (this is what gets saved to <code>Cargo.lock</code>)</li>
<li>With only the specific features the user selected on the command-line. Ideally this
run will get removed in the future when transitioning to the new feature resolver.</li>
</ol>
<p>A new feature-specific resolver was added in 2020 which adds more sophisticated feature
resolution. It is located in the <a href="features/index.html" title="mod cargo::core::resolver::features"><code>features</code></a> module. The original dependency resolver still
performs feature unification, as it can help reduce the dependencies it has to consider during
resolution (rather than assuming every optional dependency of every package is enabled).
Checking if a feature is enabled must go through the new feature resolver.</p>
<h3 id="performance"><a class="doc-anchor" href="#performance">§</a>Performance</h3>
<p>Note that this is a relatively performance-critical portion of Cargo. The
data that we’re processing is proportional to the size of the dependency
graph, which can often be quite large (e.g., take a look at Servo). To make
matters worse the DFS algorithm we’re implemented is inherently quite
inefficient. When we add the requirement of backtracking on top it means
that we’re implementing something that probably shouldn’t be allocating all
over the place.</p>
</div></details><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.CliFeatures"><code>pub use self::features::<a class="struct" href="features/struct.CliFeatures.html" title="struct cargo::core::resolver::features::CliFeatures">CliFeatures</a>;</code></div></li><li><div class="item-name" id="reexport.ForceAllTargets"><code>pub use self::features::<a class="enum" href="features/enum.ForceAllTargets.html" title="enum cargo::core::resolver::features::ForceAllTargets">ForceAllTargets</a>;</code></div></li><li><div class="item-name" id="reexport.HasDevUnits"><code>pub use self::features::<a class="enum" href="features/enum.HasDevUnits.html" title="enum cargo::core::resolver::features::HasDevUnits">HasDevUnits</a>;</code></div></li></ul><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="conflict_cache/index.html" title="mod cargo::core::resolver::conflict_cache">conflict_<wbr>cache</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="context/index.html" title="mod cargo::core::resolver::context">context</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="dep_cache/index.html" title="mod cargo::core::resolver::dep_cache">dep_<wbr>cache</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">There are 2 sources of facts for the resolver:</div></li><li><div class="item-name"><a class="mod" href="encode/index.html" title="mod cargo::core::resolver::encode">encode</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Definition of how to encode a <code>Resolve</code> into a TOML <code>Cargo.lock</code> file</div></li><li><div class="item-name"><a class="mod" href="errors/index.html" title="mod cargo::core::resolver::errors">errors</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="features/index.html" title="mod cargo::core::resolver::features">features</a></div><div class="desc docblock-short">Resolves conditional compilation for <a href="https://doc.rust-lang.org/nightly/cargo/reference/features.html"><code>features</code> section</a> in the manifest.</div></li><li><div class="item-name"><a class="mod" href="resolve/index.html" title="mod cargo::core::resolver::resolve">resolve</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="types/index.html" title="mod cargo::core::resolver::types">types</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="version_prefs/index.html" title="mod cargo::core::resolver::version_prefs">version_<wbr>prefs</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">This module implements support for preferring some versions of a package
over other versions.</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.BacktrackFrame.html" title="struct cargo::core::resolver::BacktrackFrame">Backtrack<wbr>Frame</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="struct" href="struct.EncodableDependency.html" title="struct cargo::core::resolver::EncodableDependency">Encodable<wbr>Dependency</a></div></li><li><div class="item-name"><a class="struct" href="struct.EncodablePackageId.html" title="struct cargo::core::resolver::EncodablePackageId">Encodable<wbr>Package<wbr>Id</a></div></li><li><div class="item-name"><a class="struct" href="struct.EncodableResolve.html" title="struct cargo::core::resolver::EncodableResolve">Encodable<wbr>Resolve</a></div><div class="desc docblock-short">The <code>Cargo.lock</code> structure.</div></li><li><div class="item-name"><a class="struct" href="struct.RemainingCandidates.html" title="struct cargo::core::resolver::RemainingCandidates">Remaining<wbr>Candidates</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">A helper “iterator” used to extract candidates within a current <code>Context</code> of
a dependency graph.</div></li><li><div class="item-name"><a class="struct" href="struct.Resolve.html" title="struct cargo::core::resolver::Resolve">Resolve</a></div><div class="desc docblock-short">Represents a fully-resolved package dependency graph. Each node in the graph
is a package and edges represent dependencies between packages.</div></li><li><div class="item-name"><a class="struct" href="struct.ResolveError.html" title="struct cargo::core::resolver::ResolveError">Resolve<wbr>Error</a></div><div class="desc docblock-short">Error during resolution providing a path of <code>PackageId</code>s.</div></li><li><div class="item-name"><a class="struct" href="struct.ResolveOpts.html" title="struct cargo::core::resolver::ResolveOpts">Resolve<wbr>Opts</a></div><div class="desc docblock-short">Options for how the resolve should work.</div></li><li><div class="item-name"><a class="struct" href="struct.VersionPreferences.html" title="struct cargo::core::resolver::VersionPreferences">Version<wbr>Preferences</a></div><div class="desc docblock-short">A collection of preferences for particular package versions.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.ActivateError.html" title="enum cargo::core::resolver::ActivateError">Activate<wbr>Error</a></div></li><li><div class="item-name"><a class="enum" href="enum.ResolveBehavior.html" title="enum cargo::core::resolver::ResolveBehavior">Resolve<wbr>Behavior</a></div><div class="desc docblock-short">Resolver behavior, used to opt-in to new behavior that is
backwards-incompatible via the <code>resolver</code> field in the manifest.</div></li><li><div class="item-name"><a class="enum" href="enum.ResolveVersion.html" title="enum cargo::core::resolver::ResolveVersion">Resolve<wbr>Version</a></div><div class="desc docblock-short">A version to indicate how a <code>Cargo.lock</code> should be serialized.</div></li><li><div class="item-name"><a class="enum" href="enum.VersionOrdering.html" title="enum cargo::core::resolver::VersionOrdering">Version<wbr>Ordering</a></div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.activate.html" title="fn cargo::core::resolver::activate">activate</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Attempts to activate the summary <code>candidate</code> in the context <code>cx</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.activate_deps_loop.html" title="fn cargo::core::resolver::activate_deps_loop">activate_<wbr>deps_<wbr>loop</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Recursively activates the dependencies for <code>summaries</code>, in depth-first order,
backtracking across possible candidates for each dependency as necessary.</div></li><li><div class="item-name"><a class="fn" href="fn.check_cycles.html" title="fn cargo::core::resolver::check_cycles">check_<wbr>cycles</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.check_duplicate_pkgs_in_lockfile.html" title="fn cargo::core::resolver::check_duplicate_pkgs_in_lockfile">check_<wbr>duplicate_<wbr>pkgs_<wbr>in_<wbr>lockfile</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Checks that packages are unique when written to lock file.</div></li><li><div class="item-name"><a class="fn" href="fn.find_candidate.html" title="fn cargo::core::resolver::find_candidate">find_<wbr>candidate</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Looks through the states in <code>backtrack_stack</code> for dependencies with
remaining candidates. For each one, also checks if rolling back
could change the outcome of the failed resolution that caused backtracking
in the first place. Namely, if we’ve backtracked past the parent of the
failed dep, or any of the packages flagged as giving us trouble in
<code>conflicting_activations</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.generalize_conflicting.html" title="fn cargo::core::resolver::generalize_conflicting">generalize_<wbr>conflicting</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Attempts to find a new conflict that allows a <code>find_candidate</code> better then the input one.
It will add the new conflict to the cache if one is found.</div></li><li><div class="item-name"><a class="fn" href="fn.resolve.html" title="fn cargo::core::resolver::resolve">resolve</a></div><div class="desc docblock-short">Builds the list of all packages required to build the first argument.</div></li><li><div class="item-name"><a class="fn" href="fn.shortcircuit_max.html" title="fn cargo::core::resolver::shortcircuit_max">shortcircuit_<wbr>max</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Returns Some of the largest item in the iterator.
Returns None if any of the items are None or the iterator is empty.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.ActivateResult.html" title="type cargo::core::resolver::ActivateResult">Activate<wbr>Result</a></div></li><li><div class="item-name"><a class="type" href="type.Metadata.html" title="type cargo::core::resolver::Metadata">Metadata</a></div></li></ul></section></div></main></body></html>