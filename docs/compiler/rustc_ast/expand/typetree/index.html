<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module contains the definition of the `TypeTree` and `Type` structs. They are thin Rust wrappers around the TypeTrees used by Enzyme as the LLVM based autodiff backend. The Enzyme TypeTrees currently have various limitations and should be rewritten, so the Rust frontend obviously has the same limitations. The main motivation of TypeTrees is to represent how a type looks like “in memory”. Enzyme can deduce this based on usage patterns in the user code, but this is extremely slow and not even always sufficient. As such we lower some information from rustc to help Enzyme. For a full explanation of their design it is necessary to analyze the implementation in Enzyme core itself. As a rough summary, `-1` in Enzyme speech means everywhere. That is `{0:-1: Float}` means at index 0 you have a ptr, if you dereference it it will be floats everywhere. Thus `* f32`. If you have `{-1:int}` it means int’s everywhere, e.g. [i32; N]. `{0:-1:-1 float}` then means one pointer at offset 0, if you dereference it there will be only pointers, if you dereference these new pointers they will point to array of floats. Generally, it allows byte-specific descriptions. FIXME: This description might be partly inaccurate and should be extended, along with adding documentation to the corresponding Enzyme core code. FIXME: Rewrite the TypeTree logic in Enzyme core to reduce the need for the rustc frontend to provide typetree information. FIXME: We should also re-evaluate where we create TypeTrees from Rust types, since MIR representations of some types might not be accurate. For example a vector of floats might be represented as a vector of u8s in MIR in some cases."><title>rustc_ast::expand::typetree - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="rustc_ast" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0-nightly (0aeaa5eb2 2024-12-14)" data-channel="nightly" data-search-js="search-92e6798f.js" data-settings-js="settings-0f613d39.js" ><script src="../../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../../../rustc_ast/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-9a9549ea.svg" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../../../rustc_ast/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-9a9549ea.svg" alt="logo"></a><h2><a href="../../../rustc_ast/index.html">rustc_<wbr>ast</a><span class="version">1.85.0-nightly</span></h2></div><div class="version">(0aeaa5eb2	2024-12-14)</div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module typetree</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In rustc_<wbr>ast::<wbr>expand</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../index.html">rustc_ast</a>::<wbr><a href="../index.html">expand</a></span><h1>Module <span>typetree</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/rustc_ast/expand/typetree.rs.html#1-90">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module contains the definition of the <code>TypeTree</code> and <code>Type</code> structs.
They are thin Rust wrappers around the TypeTrees used by Enzyme as the LLVM based autodiff
backend. The Enzyme TypeTrees currently have various limitations and should be rewritten, so the
Rust frontend obviously has the same limitations. The main motivation of TypeTrees is to
represent how a type looks like “in memory”. Enzyme can deduce this based on usage patterns in
the user code, but this is extremely slow and not even always sufficient. As such we lower some
information from rustc to help Enzyme. For a full explanation of their design it is necessary to
analyze the implementation in Enzyme core itself. As a rough summary, <code>-1</code> in Enzyme speech means
everywhere. That is <code>{0:-1: Float}</code> means at index 0 you have a ptr, if you dereference it it
will be floats everywhere. Thus <code>* f32</code>. If you have <code>{-1:int}</code> it means int’s everywhere,
e.g. [i32; N]. <code>{0:-1:-1 float}</code> then means one pointer at offset 0, if you dereference it there
will be only pointers, if you dereference these new pointers they will point to array of floats.
Generally, it allows byte-specific descriptions.
FIXME: This description might be partly inaccurate and should be extended, along with
adding documentation to the corresponding Enzyme core code.
FIXME: Rewrite the TypeTree logic in Enzyme core to reduce the need for the rustc frontend to
provide typetree information.
FIXME: We should also re-evaluate where we create TypeTrees from Rust types, since MIR
representations of some types might not be accurate. For example a vector of floats might be
represented as a vector of u8s in MIR in some cases.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.FncTree.html" title="struct rustc_ast::expand::typetree::FncTree">FncTree</a></div></li><li><div class="item-name"><a class="struct" href="struct.Type.html" title="struct rustc_ast::expand::typetree::Type">Type</a></div></li><li><div class="item-name"><a class="struct" href="struct.TypeTree.html" title="struct rustc_ast::expand::typetree::TypeTree">Type<wbr>Tree</a></div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Kind.html" title="enum rustc_ast::expand::typetree::Kind">Kind</a></div></li></ul></section></div></main></body></html>