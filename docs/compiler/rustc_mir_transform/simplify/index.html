<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A number of passes which remove various redundancies in the CFG."><title>rustc_mir_transform::simplify - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="rustc_mir_transform" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0-nightly (0aeaa5eb2 2024-12-14)" data-channel="nightly" data-search-js="search-92e6798f.js" data-settings-js="settings-0f613d39.js" ><script src="../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../rustc_mir_transform/index.html">rustc_<wbr>mir_<wbr>transform</a><span class="version">1.85.0-nightly</span></h2></div><div class="version">(0aeaa5eb2	2024-12-14)</div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module simplify</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate rustc_<wbr>mir_<wbr>transform</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../index.html">rustc_mir_transform</a></span><h1>Module <span>simplify</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/rustc_mir_transform/simplify.rs.html#1-609">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A number of passes which remove various redundancies in the CFG.</p>
<p>The <code>SimplifyCfg</code> pass gets rid of unnecessary blocks in the CFG, whereas the <code>SimplifyLocals</code>
gets rid of all the unnecessary local variable declarations.</p>
<p>The <code>SimplifyLocals</code> pass is kinda expensive and therefore not very suitable to be run often.
Most of the passes should not care or be impacted in meaningful ways due to extra locals
either, so running the pass once, right before codegen, should suffice.</p>
<p>On the other side of the spectrum, the <code>SimplifyCfg</code> pass is considerably cheap to run, thus
one should run it after every pass which may modify CFG in significant ways. This pass must
also be run before any analysis passes because it removes dead blocks, and some of these can be
ill-typed.</p>
<p>The cause of this typing issue is typeck allowing most blocks whose end is not reachable have
an arbitrary return type, rather than having the usual () return type (as a note, typeckâ€™s
notion of reachability is in fact slightly weaker than MIR CFG reachability - see #31617). A
standard example of the situation is:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>  <span class="kw">fn </span>example() {
      <span class="kw">let </span>_a: char = { <span class="kw">return</span>; };
  }</code></pre></div>
<p>Here the block (<code>{ return; }</code>) has the return type <code>char</code>, rather than <code>()</code>, but the MIR we
naively generate still contains the <code>_a = ()</code> write in the unreachable block â€œafterâ€ the
return.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.CfgSimplifier.html" title="struct rustc_mir_transform::simplify::CfgSimplifier">CfgSimplifier</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="struct" href="struct.LocalUpdater.html" title="struct rustc_mir_transform::simplify::LocalUpdater">Local<wbr>Updater</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="struct" href="struct.UsedLocals.html" title="struct rustc_mir_transform::simplify::UsedLocals">Used<wbr>Locals</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Keeps track of used &amp; unused locals.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.SimplifyCfg.html" title="enum rustc_mir_transform::simplify::SimplifyCfg">Simplify<wbr>Cfg</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="enum" href="enum.SimplifyLocals.html" title="enum rustc_mir_transform::simplify::SimplifyLocals">Simplify<wbr>Locals</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.make_local_map.html" title="fn rustc_mir_transform::simplify::make_local_map">make_<wbr>local_<wbr>map</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Construct the mapping while swapping out unused stuff out from the <code>vec</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.remove_dead_blocks.html" title="fn rustc_mir_transform::simplify::remove_dead_blocks">remove_<wbr>dead_<wbr>blocks</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.remove_unused_definitions.html" title="fn rustc_mir_transform::simplify::remove_unused_definitions">remove_<wbr>unused_<wbr>definitions</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.remove_unused_definitions_helper.html" title="fn rustc_mir_transform::simplify::remove_unused_definitions_helper">remove_<wbr>unused_<wbr>definitions_<wbr>helper</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Removes unused definitions. Updates the used locals to reflect the changes made.</div></li><li><div class="item-name"><a class="fn" href="fn.simplify_cfg.html" title="fn rustc_mir_transform::simplify::simplify_cfg">simplify_<wbr>cfg</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.simplify_duplicate_switch_targets.html" title="fn rustc_mir_transform::simplify::simplify_duplicate_switch_targets">simplify_<wbr>duplicate_<wbr>switch_<wbr>targets</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li></ul></section></div></main></body></html>